CREATE PROCEDURE STR_SP_LOC_DocumentosaReconciliar 
(
	IN pv_CDGEAR VARCHAR(20),
	IN pv_NMREAR VARCHAR(20)	
)
AS
BEGIN
	SELECT * FROM (
		SELECT 'PP' AS "TPO",T1."TransId" AS "NRO" FROM OVPM T0 INNER JOIN OJDT T1 ON 
		T0."TransId" = T1."TransId" INNER JOIN "@STR_EARAPR" T2 ON T0."DocEntry" = T2."U_ER_DEPE" 
		INNER JOIN "@STR_EARAPRDET" T3 ON T2."DocEntry" = T3."DocEntry"
		WHERE T3."U_ER_EARN" = :pv_CDGEAR AND T3."U_ER_NMER" = :pv_NMREAR
		UNION ALL
		SELECT 'PP' AS "TPO",T1."TransId" AS "NRO" FROM OVPM T0 INNER JOIN OJDT T1 ON 
		T0."TransId" = T1."TransId" INNER JOIN "@STR_EARCRGDET2" T2 ON T0."DocEntry" = T2."U_ER_DEPG"
		INNER JOIN "@STR_EARCRG" T3 ON T2."DocEntry" = T2."DocEntry"
		WHERE T2."U_ER_TPRG" = 'RNT' AND T3."U_ER_NMBR" = :pv_CDGEAR AND T3."U_ER_NMRO" = :pv_NMREAR
		UNION ALL
		SELECT 'AS' "TPO","TransId" AS "NRO" FROM OJDT T0 WHERE "Ref2" = :pv_CDGEAR AND "Ref3" = :pv_NMREAR AND (SELECT COUNT('A') FROM OJDT TX0 WHERE  TX0."StornoToTr" = T0."TransId") = 0  
	) AS "TY0" WHERE (SELECT COUNT('E') FROM OITR TX0 INNER JOIN ITR1 TX1 ON TX0."ReconNum" = TX1."ReconNum" AND TX1."TransId" = TY0."NRO" AND TX0."InitObjTyp" IS NULL) = 0
	ORDER BY 1 asc;
END;

